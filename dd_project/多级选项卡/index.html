<!DOCTYPE html>
<html>
<head>
	<title>城市选择</title>
	<meta name="viewport" content="width = device-width, user-scalable = 0">
	<script type="text/javascript" src="js/city.data.js"></script>
	<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="js/flexslider.js"></script>
	<link rel="stylesheet" type="text/css" href="css/flexslider.css">
	<style type="text/css">
	*{
		padding: 0;
		margin: 0;
		box-sizing: border-box;
	}
	ul li{
		list-style: none;
	}
	.select-bar{
		font-size: 16px;
		width: 100%;
		height: 200px;
		position: absolute;
		bottom: 0;
		left: 0;
		overflow: hidden;
		background-color: #fafafa;
	}
	.select-bar .select-city{
		float: left;
		width: 50%;
		background-color: #fafafa;
		padding: 15px;
		position: absolute;
/*		height: 200px;
		overflow: hidden;*/

	}
	.select-bar .select-area{
		float: right;
		width: 50%;
		padding: 15px;
		background-color: #fafafa;
/*		height: 200px;
		overflow: hidden;*/
		
	}
	.select-bar .select-area li{
		display: none;
	}
	.select-bar .select-area li:nth-child(1){
		display: block;
	}


		.showCity{
			display: block;
			width: 100%;
			height: 38px;
			/*background-color: #fafafa;*/
			text-align: center;
		}
		.showArea{
			display: block;
			width: 100%;
			height: 38px;
			/*background-color: #fafafa;*/
			text-align: center;

		}
	</style>
</head>
<body>

	<div id="selectBar" class="select-bar">
		<ul class="select-city"></ul>
		<ul class="select-area"></ul>
	</div>

<script type="text/javascript">
	var oSelect = document.getElementById('selectBar');
	var oSelectCity = oSelect.getElementsByTagName('ul')[0];
	var oSelectArea = oSelect.getElementsByTagName('ul')[1];

	oSelectCity.addEventListener('touchstart', function(event){
        let oEvent=event||window.event;
        let disY=oEvent.targetTouches[0].pageY-oSelectCity.offsetTop;

        oEvent.cancelBubble=true;
        oEvent.preventDefault();    //让touch不影响滚动条

        function fnMove(event){
            let oEvent=event||window.event;


            // if(oEvent.targetTouches[0].pageY-disY>0){
            // 	// oSelectCity.addEventListener('touchend',function(){oSelectCity.style.top=0;});  
            // 	oSelectCity.ontouchend=function(){
            // 		oSelectCity.style.top=0;
            // 	} 
            // }else{

            	oSelectCity.style.top=oEvent.targetTouches[0].pageY-disY+'px';
            // }

            
            oEvent.preventDefault();

        }
        function fnEnd(){
        	// oSelectCity.addEventListener('touchend',function(){

            	
            // });
            oSelectCity.removeEventListener('touchmove',fnMove,false);
            oSelectCity.removeEventListener('touchend',fnEnd,false);
            console.log(oSelectCity.offsetTop);
            // if(oSelectCity.offsetTop>0)
            // {
            	
            // 	oSelectCity.style.top=0;
            // }else{
            // 	oSelectCity.style.top=oEvent.targetTouches[0].pageY-disY+'px';
            // }
        }

        oSelectCity.addEventListener('touchmove',fnMove,false);
        oSelectCity.addEventListener('touchend',fnEnd,false);
    },false)

	// function choiceCity(a){
	for(a in cityData)
	{
		var oSelectCityLi = document.createElement('li');
		oSelectCityLi.innerHTML = cityData[a].text;
		oSelectCityLi.className = 'showCity';

		var oSelectAreaLi = document.createElement('li');
		for(b in cityData[a].children){
			var oDiv = document.createElement('div');
			oDiv.innerHTML = cityData[a].children[b].text;
			oDiv.className = 'showArea';
			oSelectAreaLi.appendChild(oDiv);

			// console.log(cityData[a].children[b].text);
		}

		oSelectCity.appendChild(oSelectCityLi);
		oSelectArea.appendChild(oSelectAreaLi);
		// console.log(cityData[a].text);
	}

	var oSelectCityLi = oSelectCity.getElementsByTagName('li');
	var oSelectAreaLi = oSelectArea.getElementsByTagName('li');
	
	for(let i=0;i<oSelectCityLi.length;i++)
	{
		oSelectCityLi[i].ontouchend=function(){
			for(let i=0;i<oSelectCityLi.length;i++)
			{
				oSelectAreaLi[i].style.display = 'none';
			}
			oSelectAreaLi[i].style.display = 'block';
		}
	}


	// }
	

</script>
</body>
</html>